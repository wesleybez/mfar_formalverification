<?xml version="1.0" encoding="utf-8"?><!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_1.dtd'><nta><declaration>// Place global declarations here.
broadcast chan reg, reg_ok, reg_fail, unreg;
broadcast chan step1, validate_step1, step1_ok, step1_fail;
broadcast chan generate_query, send_query, validate_query, solve_query;
broadcast chan step2, step2_ok, step2_fail;
broadcast chan receive_data, send_data, validate_data, data_ok, data_fail, wait_data;
broadcast chan validate_authcode, authcode_fail, reset;
broadcast chan increase_reputation, decrease_reputation;
broadcast chan raise_authlevel, enforcement, invalidate_access;
broadcast chan compatibility_data, compatibility_mode;
broadcast chan step3_ok, step3_fail;

int score = 10;
int max = 20;
int authlevel = 0;
int min = 3;

bool is_waiting_query=false;

clock creg, csensor, calevel, cauth;</declaration><template><name x="5" y="5">Registration</name><declaration>// Place local declarations here.
clock c_registration;</declaration><location id="id0" x="24" y="-48"><name x="14" y="-78">r1</name><committed/></location><location id="id1" x="152" y="-144"><name x="142" y="-174">r0</name></location><location id="id2" x="-104" y="-144"><name x="-114" y="-174">n</name><committed/></location><init ref="id2"/><transition><source ref="id1"/><target ref="id2"/><label kind="synchronisation" x="0" y="-256">reg_fail!</label><nail x="24" y="-232"/></transition><transition><source ref="id0"/><target ref="id2"/><label kind="synchronisation" x="-80" y="-88">unreg?</label></transition><transition><source ref="id1"/><target ref="id0"/><label kind="synchronisation" x="96" y="-96">reg_ok!</label></transition><transition><source ref="id2"/><target ref="id1"/><label kind="synchronisation" x="-40" y="-159">reg?</label></transition></template><template><name>Authentication</name><declaration>clock c_authentication;</declaration><location id="id3" x="232" y="-152"><name x="222" y="-182">q11</name></location><location id="id4" x="232" y="-264"><name x="222" y="-294">q12</name></location><location id="id5" x="232" y="-64"><name x="222" y="-94">q6</name></location><location id="id6" x="-8" y="-64"><name x="-18" y="-94">q5</name><committed/></location><location id="id7" x="-8" y="-168"><name x="-18" y="-198">q7</name></location><location id="id8" x="-8" y="-264"><name x="-18" y="-294">q10</name></location><location id="id9" x="-208" y="56"><name x="-218" y="26">q8</name><committed/></location><location id="id10" x="-208" y="-64"><name x="-218" y="-94">q3</name></location><location id="id11" x="-208" y="-264"><name x="-218" y="-294">q9</name></location><location id="id12" x="-448" y="-168"></location><location id="id13" x="-448" y="-168"><name x="-458" y="-198">q2</name></location><location id="id14" x="-448" y="-64"><name x="-458" y="-94">q1</name></location><location id="id15" x="-448" y="56"><name x="-458" y="26">q0</name></location><init ref="id15"/><transition><source ref="id11"/><target ref="id10"/><label kind="synchronisation" x="-232" y="-192">step2?</label></transition><transition><source ref="id9"/><target ref="id15"/><label kind="synchronisation" x="-388" y="37">reset?</label></transition><transition><source ref="id3"/><target ref="id3"/><label kind="guard" x="308" y="-175">score &lt; max</label><label kind="synchronisation" x="308" y="-159">increase_reputation!</label><label kind="assignment" x="308" y="-143">score = score + 1</label><nail x="304" y="-120"/><nail x="304" y="-184"/></transition><transition><source ref="id3"/><target ref="id6"/><label kind="synchronisation" x="128" y="-128">wait_data!</label></transition><transition><source ref="id5"/><target ref="id7"/><label kind="synchronisation" x="152" y="-96">data_fail!</label></transition><transition><source ref="id4"/><target ref="id3"/><label kind="synchronisation" x="144" y="-248">step3_ok!</label><label kind="assignment" x="144" y="-232">authlevel = 3</label><nail x="192" y="-208"/></transition><transition><source ref="id3"/><target ref="id4"/><label kind="guard" x="248" y="-208">score &gt; max and authlevel != 3</label><label kind="synchronisation" x="248" y="-224">raise_authlevel!</label><nail x="280" y="-208"/></transition><transition><source ref="id5"/><target ref="id3"/><label kind="synchronisation" x="240" y="-120">data_ok!</label></transition><transition><source ref="id5"/><target ref="id5"/><label kind="synchronisation" x="312" y="-72">validate_data!</label><nail x="304" y="-16"/><nail x="304" y="-104"/></transition><transition><source ref="id5"/><target ref="id5"/><label kind="synchronisation" x="168" y="16">validate_authcode!</label><nail x="176" y="8"/><nail x="296" y="8"/></transition><transition><source ref="id5"/><target ref="id9"/><label kind="synchronisation" x="-72" y="56">authcode_fail!</label><nail x="56" y="56"/></transition><transition><source ref="id6"/><target ref="id5"/><label kind="synchronisation" x="52" y="-79">send_data?</label></transition><transition><source ref="id7"/><target ref="id9"/><label kind="guard" x="-160" y="-24">score&lt;min</label><label kind="synchronisation" x="-160" y="-39">invalidate_access!</label></transition><transition><source ref="id7"/><target ref="id6"/><label kind="guard" x="0" y="-112">score&gt;=min</label><label kind="synchronisation" x="0" y="-128">wait_data!</label><nail x="40" y="-104"/></transition><transition><source ref="id7"/><target ref="id7"/><label kind="guard" x="40" y="-168">score &gt;= min</label><label kind="synchronisation" x="32" y="-184">decrease_reputation!</label><label kind="assignment" x="40" y="-152">score = score - 1</label><nail x="72" y="-200"/><nail x="72" y="-136"/></transition><transition><source ref="id7"/><target ref="id8"/><label kind="guard" x="-80" y="-224">score &lt; min and authlevel==3</label><label kind="synchronisation" x="-24" y="-240">step3_fail!</label></transition><transition><source ref="id8"/><target ref="id11"/><label kind="synchronisation" x="-192" y="-279">enforcement!</label></transition><transition><source ref="id10"/><target ref="id6"/><label kind="synchronisation" x="-188" y="-83">step2_ok!</label><label kind="assignment" x="-192" y="-64">authlevel = 2</label></transition><transition><source ref="id10"/><target ref="id9"/><label kind="synchronisation" x="-240" y="-24">step2_fail!</label></transition><transition><source ref="id12"/><target ref="id10"/><label kind="synchronisation" x="-304" y="-128">step2?</label><label kind="assignment" x="-388" y="-116">is_waiting_query = false</label></transition><transition><source ref="id14"/><target ref="id9"/><label kind="synchronisation" x="-304" y="0">step1_fail!</label></transition><transition><source ref="id14"/><target ref="id12"/><label kind="synchronisation" x="-508" y="-131">step1_ok!</label><label kind="assignment" x="-508" y="-116">authlevel = 1</label></transition><transition><source ref="id15"/><target ref="id14"/><label kind="synchronisation" x="-480" y="-8">step1?</label></transition></template><template><name>AuthLevel</name><declaration>clock c_authlevel;</declaration><location id="id16" x="0" y="-56"><name x="-10" y="-86">q6</name><committed/></location><location id="id17" x="-184" y="72"><name x="-194" y="42">q5</name></location><location id="id18" x="-184" y="-56"><name x="-194" y="-86">q2</name></location><location id="id19" x="-344" y="-176"><name x="-354" y="-206">q4</name><committed/></location><location id="id20" x="-344" y="-56"><name x="-354" y="-86">q1</name></location><location id="id21" x="-496" y="-56"><name x="-506" y="-86">q0</name></location><init ref="id21"/><transition><source ref="id17"/><target ref="id18"/><label kind="guard" x="-288" y="0">authlevel==2</label><label kind="synchronisation" x="-288" y="-16">wait_data?</label><nail x="-280" y="8"/></transition><transition><source ref="id17"/><target ref="id16"/><label kind="guard" x="0" y="-8">authlevel==3</label><label kind="synchronisation" x="0" y="8">wait_data?</label><nail x="0" y="72"/></transition><transition><source ref="id17"/><target ref="id20"/><label kind="synchronisation" x="-312" y="104">enforcement?</label><nail x="-184" y="120"/><nail x="-344" y="120"/></transition><transition><source ref="id19"/><target ref="id21"/><label kind="synchronisation" x="-496" y="-248">reset?</label><nail x="-376" y="-224"/><nail x="-584" y="-224"/><nail x="-584" y="40"/></transition><transition><source ref="id20"/><target ref="id20"/><label kind="synchronisation" x="-360" y="0">step2?</label><nail x="-300" y="-1"/><nail x="-380" y="-1"/></transition><transition><source ref="id21"/><target ref="id19"/><label kind="synchronisation" x="-528" y="-144">step1_fail?</label><nail x="-496" y="-176"/></transition><transition><source ref="id17"/><target ref="id19"/><label kind="synchronisation" x="-360" y="48">invalidate_access?</label><nail x="-408" y="72"/><nail x="-408" y="-176"/></transition><transition><source ref="id18"/><target ref="id17"/><label kind="synchronisation" x="-184" y="-24">data_fail?</label></transition><transition><source ref="id16"/><target ref="id17"/><label kind="synchronisation" x="-112" y="16">data_fail?</label></transition><transition><source ref="id18"/><target ref="id16"/><label kind="synchronisation" x="-152" y="-71">step3_ok?</label></transition><transition><source ref="id16"/><target ref="id19"/><label kind="synchronisation" x="-152" y="-168">authcode_fail?</label><nail x="0" y="-176"/></transition><transition><source ref="id18"/><target ref="id19"/><label kind="synchronisation" x="-288" y="-112">authcode_fail?</label></transition><transition><source ref="id20"/><target ref="id18"/><label kind="synchronisation" x="-324" y="-71">step2_ok?</label></transition><transition><source ref="id20"/><target ref="id19"/><label kind="synchronisation" x="-404" y="-131">step2_fail?</label></transition><transition><source ref="id21"/><target ref="id20"/><label kind="synchronisation" x="-480" y="-71">step1_ok?</label></transition></template><template><name>Sensor</name><declaration>clock c_sensor;</declaration><location id="id22" x="-368" y="216"><name x="-378" y="186">q9</name></location><location id="id23" x="-96" y="72"><name x="-106" y="42">q5</name></location><location id="id24" x="-96" y="-56"><name x="-106" y="-86">q4</name></location><location id="id25" x="-232" y="176"><name x="-242" y="146">q7</name><committed/></location><location id="id26" x="-232" y="72"><name x="-242" y="42">q6</name></location><location id="id27" x="-240" y="-56"><name x="-250" y="-86">q3</name><committed/></location><location id="id28" x="-368" y="72"><name x="-378" y="42">q2</name><committed/></location><location id="id29" x="-368" y="-56"><name x="-378" y="-86">q1</name></location><location id="id30" x="-512" y="-56"><name x="-522" y="-86">q0</name></location><init ref="id27"/><transition><source ref="id22"/><target ref="id23"/><label kind="synchronisation" x="-312" y="256">enforcement?</label><nail x="-368" y="256"/><nail x="-168" y="256"/></transition><transition><source ref="id22"/><target ref="id28"/><label kind="synchronisation" x="-400" y="104">authcode_fail?</label></transition><transition><source ref="id22"/><target ref="id28"/><label kind="synchronisation" x="-536" y="160">invalidate_access?</label><nail x="-472" y="216"/><nail x="-472" y="72"/></transition><transition><source ref="id22"/><target ref="id25"/><label kind="synchronisation" x="-312" y="208">wait_data?</label></transition><transition><source ref="id28"/><target ref="id27"/><label kind="synchronisation" x="-336" y="-16">reset!</label></transition><transition><source ref="id27"/><target ref="id24"/><label kind="synchronisation" x="-208" y="-80">step1!</label></transition><transition><source ref="id24"/><target ref="id23"/><label kind="synchronisation" x="-144" y="-16">step1_ok?</label></transition><transition><source ref="id23"/><target ref="id26"/><label kind="synchronisation" x="-192" y="57">step2!</label></transition><transition><source ref="id25"/><target ref="id22"/><label kind="synchronisation" x="-344" y="136">send_data!</label><nail x="-336" y="144"/></transition><transition><source ref="id26"/><target ref="id25"/><label kind="synchronisation" x="-232" y="112">step2_ok?</label></transition><transition><source ref="id29"/><target ref="id27"/><label kind="synchronisation" x="-320" y="-71">reg_ok?</label></transition><transition><source ref="id24"/><target ref="id28"/><label kind="synchronisation" x="-264" y="-24">step1_fail?</label></transition><transition><source ref="id26"/><target ref="id28"/><label kind="synchronisation" x="-336" y="56">step2_fail?</label></transition><transition><source ref="id29"/><target ref="id28"/><label kind="synchronisation" x="-424" y="-8">reg_fail?</label></transition><transition><source ref="id30"/><target ref="id29"/><label kind="synchronisation" x="-500" y="-71">reg!</label></transition></template><system>// Place template instantiations here.
registration = Registration();
authentication = Authentication();
alevel = AuthLevel();
sensor = Sensor();

// List one or more processes to be composed into a system.
system sensor, alevel, authentication;
//registration, sensor, </system></nta>